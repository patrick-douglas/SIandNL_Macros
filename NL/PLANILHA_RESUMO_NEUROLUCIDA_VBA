Sub CRIAR_PLANILHA_RESUMO()
    Dim xFd As FileDialog
    Dim xFdItem As Variant
    Dim xFileName As String
    Set xFd = Application.FileDialog(msoFileDialogFolderPicker)
    If xFd.Show = -1 Then
        xFdItem = xFd.SelectedItems(1) & Application.PathSeparator
        xFileName = Dir(xFdItem & "*.xls*")
        Do While xFileName <> ""
            With Workbooks.Open(xFdItem & xFileName)
            
Application.ScreenUpdating = True
sFileName = Split(xFileName, "\")(UBound(Split(xFileName, "\")))

'NAME OF EXCEL WORKBOOK
    Windows(sFileName).Activate
    Sheets("Neuron Summary").Select
    Range("A1").Select
    ActiveCell.Offset(1, 26).Range("A1").Select
    ActiveCell.FormulaR1C1 = sFileName
    Selection.Copy
    Windows("PLANILHA_RESUMO_NEUROLUCIDA.xlsm").Activate
    ActiveCell.Offset(0, 0).Range("A1").Select
    ActiveCell.Offset(1, 0).Range("A1").Select
    Selection.PasteSpecial Paste:=xlPasteValues, Operation:=xlNone, SkipBlanks _
        :=False, Transpose:=False
'Length SUM (µm)
    Windows(sFileName).Activate
    Sheets("Segment-Dendrites").Select
    Range("A1").Select
    ActiveCell.Offset(0, 14).Range("A1").Select
    ActiveCell.FormulaR1C1 = "=SUM(C[-12])"
    Selection.Copy
    Windows("PLANILHA_RESUMO_NEUROLUCIDA.xlsm").Activate
    ActiveCell.Offset(0, 0).Range("A1").Select
    ActiveCell.Offset(0, 1).Range("A1").Select
    Selection.PasteSpecial Paste:=xlPasteValues, Operation:=xlNone, SkipBlanks _
        :=False, Transpose:=False
    
'Length Average (µm)
    Windows(sFileName).Activate
    Sheets("Segment-Dendrites").Select
    Range("A1").Select
    ActiveCell.Offset(0, 15).Range("A1").Select
    ActiveCell.FormulaR1C1 = "=AVERAGE(C3)"
    Selection.Copy
    Windows("PLANILHA_RESUMO_NEUROLUCIDA.xlsm").Activate
    ActiveCell.Offset(0, 0).Range("A1").Select
    ActiveCell.Offset(0, 1).Range("A1").Select
    Selection.PasteSpecial Paste:=xlPasteValues, Operation:=xlNone, SkipBlanks _
        :=False, Transpose:=False
    
'Tortuosity Average
    Windows(sFileName).Activate
    Sheets("Segment-Dendrites").Select
    Range("A1").Select
    ActiveCell.Offset(0, 16).Range("A1").Select
    ActiveCell.FormulaR1C1 = "=AVERAGE(C4)"
    Selection.Copy
    Windows("PLANILHA_RESUMO_NEUROLUCIDA.xlsm").Activate
    ActiveCell.Offset(0, 0).Range("A1").Select
    ActiveCell.Offset(0, 1).Range("A1").Select
    Selection.PasteSpecial Paste:=xlPasteValues, Operation:=xlNone, SkipBlanks _
        :=False, Transpose:=False
    
'Surface Area (Average µm²)
    Windows(sFileName).Activate
    Sheets("Segment-Dendrites").Select
    Range("A1").Select
    ActiveCell.Offset(0, 17).Range("A1").Select
    ActiveCell.FormulaR1C1 = "=AVERAGE(C5)"
    Selection.Copy
    Windows("PLANILHA_RESUMO_NEUROLUCIDA.xlsm").Activate
    ActiveCell.Offset(0, 0).Range("A1").Select
    ActiveCell.Offset(0, 1).Range("A1").Select
    Selection.PasteSpecial Paste:=xlPasteValues, Operation:=xlNone, SkipBlanks _
        :=False, Transpose:=False
        
'TREE Volume(Average µm³)
    Windows(sFileName).Activate
    Sheets("Segment-Dendrites").Select
    Range("A1").Select
    ActiveCell.Offset(0, 18).Range("A1").Select
    ActiveCell.FormulaR1C1 = "=AVERAGE(C6)"
    Selection.Copy
    Windows("PLANILHA_RESUMO_NEUROLUCIDA.xlsm").Activate
    ActiveCell.Offset(0, 0).Range("A1").Select
    ActiveCell.Offset(0, 1).Range("A1").Select
    Selection.PasteSpecial Paste:=xlPasteValues, Operation:=xlNone, SkipBlanks _
        :=False, Transpose:=False
     

'Base Diameter (Average µm)
    Windows(sFileName).Activate
    Sheets("Segment-Dendrites").Select
    Range("A1").Select
    ActiveCell.Offset(0, 20).Range("A1").Select
    ActiveCell.FormulaR1C1 = "=AVERAGE(C12)"
    Selection.Copy
    Windows("PLANILHA_RESUMO_NEUROLUCIDA.xlsm").Activate
    ActiveCell.Offset(0, 0).Range("A1").Select
    ActiveCell.Offset(0, 1).Range("A1").Select
    Selection.PasteSpecial Paste:=xlPasteValues, Operation:=xlNone, SkipBlanks _
        :=False, Transpose:=False

'No of segments
    Windows(sFileName).Activate
    Sheets("Tree Totals-Dendrite").Select
    Range("A1").Select
    ActiveCell.Offset(0, 12).Range("A1").Select
    ActiveCell.FormulaR1C1 = "=SUM(C2)"
    Selection.Copy
    Windows("PLANILHA_RESUMO_NEUROLUCIDA.xlsm").Activate
    ActiveCell.Offset(0, 0).Range("A1").Select
    ActiveCell.Offset(0, 1).Range("A1").Select
    Selection.PasteSpecial Paste:=xlPasteValues, Operation:=xlNone, SkipBlanks _
        :=False, Transpose:=False

'Segments/mm
    Windows(sFileName).Activate
    Sheets("Tree Totals-Dendrite").Select
    Range("A1").Select
    ActiveCell.Offset(0, 32).Range("A1").Select
    ActiveCell.FormulaR1C1 = "=SUM(C[-31])"
        Range("A1").Select
    ActiveCell.Offset(0, 33).Range("A1").Select
    ActiveCell.FormulaR1C1 = "=SUM(C[-31])"
        Range("A1").Select
    ActiveCell.Offset(1, 33).Range("A1").Select
    ActiveCell.FormulaR1C1 = "=R[-1]C/1000"
        Range("A1").Select
    ActiveCell.Offset(2, 33).Range("A1").Select
    Application.CutCopyMode = False
    ActiveCell.FormulaR1C1 = "=R[-2]C[-1]/R[-1]C"
    Selection.Copy
    Windows("PLANILHA_RESUMO_NEUROLUCIDA.xlsm").Activate
    ActiveCell.Offset(0, 0).Range("A1").Select
    ActiveCell.Offset(0, 1).Range("A1").Select
    Selection.PasteSpecial Paste:=xlPasteValues, Operation:=xlNone, SkipBlanks _
        :=False, Transpose:=False

'No of trees
    Windows(sFileName).Activate
    Sheets("Neuron Summary").Select
    Range("A1").Select
    ActiveCell.Offset(0, 22).Range("A1").Select
    ActiveCell.FormulaR1C1 = "=R[3]C[-21]"
    Selection.Copy
    Windows("PLANILHA_RESUMO_NEUROLUCIDA.xlsm").Activate
    ActiveCell.Offset(0, 0).Range("A1").Select
    ActiveCell.Offset(0, 1).Range("A1").Select
    Selection.PasteSpecial Paste:=xlPasteValues, Operation:=xlNone, SkipBlanks _
        :=False, Transpose:=False

'Surface(µm²)
    Windows(sFileName).Activate
    Sheets("Neuron Summary").Select
    Range("A1").Select
    ActiveCell.Offset(3, 17).Range("A1").Select
    Selection.Copy
    Windows("PLANILHA_RESUMO_NEUROLUCIDA.xlsm").Activate
    ActiveCell.Offset(0, 0).Range("A1").Select
    ActiveCell.Offset(0, 1).Range("A1").Select
    Selection.PasteSpecial Paste:=xlPasteValues, Operation:=xlNone, SkipBlanks _
        :=False, Transpose:=False

'Complexity
    Windows(sFileName).Activate
    Sheets("Neuron Summary").Select
    Range("A1").Select
    ActiveCell.Offset(3, 21).Range("A1").Select
    Selection.Copy
    Windows("PLANILHA_RESUMO_NEUROLUCIDA.xlsm").Activate
    ActiveCell.Offset(0, 0).Range("A1").Select
    ActiveCell.Offset(0, 1).Range("A1").Select
    Selection.PasteSpecial Paste:=xlPasteValues, Operation:=xlNone, SkipBlanks _
        :=False, Transpose:=False

'Planar angle (Average)
    Windows(sFileName).Activate
    Sheets("Branch Angle-Dendrite").Select
    Range("A1").Select
    ActiveCell.Offset(0, 5).Range("A1").Select
    ActiveCell.FormulaR1C1 = "=AVERAGE(C3)"
    Selection.Copy
    Windows("PLANILHA_RESUMO_NEUROLUCIDA.xlsm").Activate
    ActiveCell.Offset(0, 0).Range("A1").Select
    ActiveCell.Offset(0, 1).Range("A1").Select
    Selection.PasteSpecial Paste:=xlPasteValues, Operation:=xlNone, SkipBlanks _
        :=False, Transpose:=False

'Convex Hull Volume (µm³)
    Windows(sFileName).Activate
    Sheets("Convex Hull 3D").Select
    Range("A1").Select
    ActiveCell.Offset(1, 0).Range("A1").Select
    Selection.Copy
    Windows("PLANILHA_RESUMO_NEUROLUCIDA.xlsm").Activate
    ActiveCell.Offset(0, 0).Range("A1").Select


    ActiveCell.Offset(0, 1).Range("A1").Select
    Selection.PasteSpecial Paste:=xlPasteValues, Operation:=xlNone, SkipBlanks _
        :=False, Transpose:=False

'Convex Hull Surface (µm²)
    Windows(sFileName).Activate
    Sheets("Convex Hull 3D").Select
    Range("A1").Select
    ActiveCell.Offset(1, 1).Range("A1").Select
    Selection.Copy
    Windows("PLANILHA_RESUMO_NEUROLUCIDA.xlsm").Activate
    ActiveCell.Offset(0, 0).Range("A1").Select


    ActiveCell.Offset(0, 1).Range("A1").Select
    Selection.PasteSpecial Paste:=xlPasteValues, Operation:=xlNone, SkipBlanks _
        :=False, Transpose:=False


'Convex Hull Area (µm²)
    Windows(sFileName).Activate
    Sheets("Convex Hull 2D").Select
    Range("A1").Select
    ActiveCell.Offset(1, 0).Range("A1").Select
    Selection.Copy
    Windows("PLANILHA_RESUMO_NEUROLUCIDA.xlsm").Activate
    ActiveCell.Offset(0, 0).Range("A1").Select


    ActiveCell.Offset(0, 1).Range("A1").Select
    Selection.PasteSpecial Paste:=xlPasteValues, Operation:=xlNone, SkipBlanks _
        :=False, Transpose:=False

'Convex Hull Perimeter (µm)
    Windows(sFileName).Activate
    Sheets("Convex Hull 2D").Select
    Range("A1").Select
    ActiveCell.Offset(1, 1).Range("A1").Select
    Selection.Copy
    Windows("PLANILHA_RESUMO_NEUROLUCIDA.xlsm").Activate
    ActiveCell.Offset(0, 0).Range("A1").Select


    ActiveCell.Offset(0, 1).Range("A1").Select
    Selection.PasteSpecial Paste:=xlPasteValues, Operation:=xlNone, SkipBlanks _
        :=False, Transpose:=False

'k-Dim
    Windows(sFileName).Activate
    Sheets("Box Counting-Trees").Select
    Range("A1").Select
    ActiveCell.Offset(12, 2).Range("A1").Select
    Selection.Copy
    Windows("PLANILHA_RESUMO_NEUROLUCIDA.xlsm").Activate
    ActiveCell.Offset(0, 0).Range("A1").Select


    ActiveCell.Offset(0, 1).Range("A1").Select
    Selection.PasteSpecial Paste:=xlPasteValues, Operation:=xlNone, SkipBlanks _
        :=False, Transpose:=False
    Windows(sFileName).Activate
    Sheets("Vertex-Dendrite").Select
    Range("A1").Select

 
'VERTEX_DENDRITE Macro
' DEL ALL ROWS THAT CONTAINS "Total" AND "Ajusted"
'  Dim rng As Range, cell As Range, del As Range
'  Set rng = Intersect(Range("A:A"), ActiveSheet.UsedRange)
'  For Each cell In rng
'    If (cell.Value) = "Total" _
'    Then
'      If del Is Nothing Then
'        Set del = cell
'      Else: Set del = Union(del, cell)
'      End If
'    End If
'  Next cell
'    For Each cell In rng
'  If (cell.Value) = "Adjusted" _
'    Then
'      If del Is Nothing Then
'        Set del = cell
'      Else: Set del = Union(del, cell)
'      End If
'    End If
'    Next cell
'  On Error Resume Next
'    del.EntireRow.Delete

    Windows(sFileName).Activate
    Sheets("Vertex-Dendrite").Select
    Last = Cells(Rows.Count, "A").End(xlUp).Row
    For i = Last To 1 Step -1
        If (Cells(i, "A").Value) = "Total" Then
                Cells(i, "A").EntireRow.Delete
        End If
    Next i
    Last = Cells(Rows.Count, "A").End(xlUp).Row
    For i = Last To 1 Step -1
        If (Cells(i, "A").Value) = "Adjusted" Then
                Cells(i, "A").EntireRow.Delete
        End If
    Next i
    
'EXECUTE MATHS
    Windows(sFileName).Activate
    Sheets("Vertex-Dendrite").Select
    Range("A1").Select
    ActiveCell.Offset(0, 10).Range("A1").Select
    Application.CutCopyMode = False
    ActiveCell.FormulaR1C1 = "=SUM(C[-8])"
    ActiveCell.Offset(0, 1).Range("A1").Select
    ActiveCell.FormulaR1C1 = "=SUM(C[-8])"
    ActiveCell.Offset(0, 1).Range("A1").Select
    ActiveCell.FormulaR1C1 = "=SUM(C[-8])"
   
'COPY RESULTS OF SUM OF VA, VB, BC TO PLANILHA_RESUMO_NEUROLUCIDA.xlsm
    Windows(sFileName).Activate
    Sheets("Vertex-Dendrite").Select
    Range("A1").Select
    ActiveCell.Offset(0, 10).Range("A1").Select
    Selection.Copy
    Windows("PLANILHA_RESUMO_NEUROLUCIDA.xlsm").Activate
    ActiveCell.Offset(0, 1).Range("A1").Select
        Selection.PasteSpecial Paste:=xlPasteValues, Operation:=xlNone, SkipBlanks _
        :=False, Transpose:=False
        
    Windows(sFileName).Activate
    Range("A1").Select
    ActiveCell.Offset(0, 11).Range("A1").Select
    Selection.Copy
    Windows("PLANILHA_RESUMO_NEUROLUCIDA.xlsm").Activate
    ActiveCell.Offset(0, 0).Range("A1").Select
    ActiveCell.Offset(0, 1).Range("A1").Select
    Selection.PasteSpecial Paste:=xlPasteValues, Operation:=xlNone, SkipBlanks _
        :=False, Transpose:=False
    Windows(sFileName).Activate
        Range("A1").Select
    ActiveCell.Offset(0, 12).Range("A1").Select
    Selection.Copy
    Windows("PLANILHA_RESUMO_NEUROLUCIDA.xlsm").Activate
    ActiveCell.Offset(0, 0).Range("A1").Select
    ActiveCell.Offset(0, 1).Range("A1").Select
    Selection.PasteSpecial Paste:=xlPasteValues, Operation:=xlNone, SkipBlanks _
        :=False, Transpose:=False
    ActiveCell.Offset(0, -20).Range("A1").Select
    Windows("PLANILHA_RESUMO_NEUROLUCIDA.xlsm").Activate
    ActiveSheet.Cells.Columns("B:B").AutoFit
Workbooks(sFileName).Close SaveChanges:=False
Application.ScreenUpdating = False

            End With
            xFileName = Dir
        Loop
    End If
End Sub